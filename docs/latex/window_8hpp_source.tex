\hypertarget{window_8hpp_source}{}\doxysection{window.\+hpp}
\label{window_8hpp_source}\index{src/rpp/rpp/operators/window.hpp@{src/rpp/rpp/operators/window.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ReactivePlusPlus\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ Copyright\ Aleksey\ Loginov\ 2022\ -\/\ present.}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Distributed\ under\ the\ Boost\ Software\ License,\ Version\ 1.0.}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ \ \ \ (See\ accompanying\ file\ LICENSE\_1\_0.txt\ or\ copy\ at}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ https://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{00007\ \textcolor{comment}{//}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Project\ home:\ https://github.com/victimsnino/ReactivePlusPlus}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <rpp/operators/fwd/window.hpp>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <rpp/subjects/publish\_subject.hpp>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <rpp/subscribers/constraints.hpp>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <rpp/operators/details/subscriber\_with\_state.hpp>}\ \textcolor{comment}{//\ create\_subscriber\_with\_state}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ IMPLEMENTATION\_FILE(window\_tag);}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{namespace\ }rpp}
\DoxyCodeLine{00022\ \{}
\DoxyCodeLine{00023\ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00024\ \textcolor{keyword}{using\ }windowed\_observable\ =\ \textcolor{keyword}{decltype}(std::declval<subjects::publish\_subject<Type>>().get\_observable());}
\DoxyCodeLine{00025\ \}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }rpp::details}
\DoxyCodeLine{00028\ \{}
\DoxyCodeLine{00029\ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00030\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrpp_1_1details_1_1window__state}{window\_state}}}
\DoxyCodeLine{00031\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ window\_size\{\};}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ items\_in\_current\_window\ =\ window\_size;}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classrpp_1_1subjects_1_1publish__subject}{subjects::publish\_subject<Type>}}\ subject\{\};}
\DoxyCodeLine{00035\ \};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrpp_1_1details_1_1window__on__next}{window\_on\_next}}}
\DoxyCodeLine{00038\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{void}\ operator()(\textcolor{keyword}{auto}\&\&\ value,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ subscriber,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrpp_1_1details_1_1window__state}{window\_state<Type>}}\&\ state)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00041\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ need\ to\ send\ new\ subject\ due\ to\ NEW\ item\ appeared\ (we\ avoid\ sending\ new\ subjects\ if\ no\ any\ new\ items)}}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state.items\_in\_current\_window\ ==\ state.window\_size)}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ subscriber.on\_next(state.subject.get\_observable());}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ state.items\_in\_current\_window\ =\ 0;}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ ++state.items\_in\_current\_window;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ state.subject.get\_subscriber().on\_next(std::forward<\textcolor{keyword}{decltype}(value)>(value));}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cleanup\ current\ subject,\ but\ don't\ send\ due\ to\ wait\ for\ new\ value}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state.items\_in\_current\_window\ ==\ state.window\_size)}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ state.subject.get\_subscriber().on\_completed();}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ state.subject\ =\ \mbox{\hyperlink{classrpp_1_1subjects_1_1publish__subject}{rpp::subjects::publish\_subject<Type>}}\{\};}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00058\ \ \ \ \ \}}
\DoxyCodeLine{00059\ \};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrpp_1_1details_1_1window__on__error}{window\_on\_error}}}
\DoxyCodeLine{00062\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{void}\ operator()(\textcolor{keyword}{const}\ std::exception\_ptr\&\ err,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ subscriber,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrpp_1_1details_1_1window__state}{window\_state<Type>}}\&\ state)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00065\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ state.subject.get\_subscriber().on\_error(err);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ subscriber.on\_error(err);}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ \};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrpp_1_1details_1_1window__on__completed}{window\_on\_completed}}}
\DoxyCodeLine{00072\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{void}\ operator()(\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ subscriber,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrpp_1_1details_1_1window__state}{window\_state<Type>}}\&\ state)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00075\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ state.subject.get\_subscriber().on\_completed();}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ subscriber.on\_completed();}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type>}
\DoxyCodeLine{00082\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrpp_1_1details_1_1window__lift__impl}{window\_lift\_impl}}}
\DoxyCodeLine{00083\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ window\_size\{\};}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::subscriber\_of\_type<windowed\_observable<Type>>\ TSub>}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{auto}\ operator()(TSub\&\&\ subscriber)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00088\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ subscription\ =\ subscriber.get\_subscription();}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dynamic\_state\ there\ to\ make\ shared\_ptr\ for\ observer\ instead\ of\ making\ shared\_ptr\ for\ state}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ create\_subscriber\_with\_dynamic\_state<Type>(std::move(subscription),}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrpp_1_1details_1_1window__on__next}{window\_on\_next}}\{\},}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrpp_1_1details_1_1window__on__error}{window\_on\_error}}\{\},}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrpp_1_1details_1_1window__on__completed}{window\_on\_completed}}\{\},}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward<TSub>(subscriber),}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrpp_1_1details_1_1window__state}{window\_state<Type>}}\{window\_size\});}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ \};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{template}<constra\textcolor{keywordtype}{int}::decayed\_type\ Type,\ constra\textcolor{keywordtype}{int}::observable\_of\_type<Type>\ TObs>}
\DoxyCodeLine{00102\ \textcolor{keyword}{auto}\ window\_impl(TObs\&\&\ obs,\ \textcolor{keywordtype}{size\_t}\ window\_size)}
\DoxyCodeLine{00103\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{return}\ std::forward<TObs>(obs).template\ lift<windowed\_observable<Type>>(\mbox{\hyperlink{structrpp_1_1details_1_1window__lift__impl}{window\_lift\_impl<Type>}}\{window\_size\});}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ \}\ \textcolor{comment}{//\ namespace\ rpp::details}}

\end{DoxyCode}
