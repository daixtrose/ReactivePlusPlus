\hypertarget{utils_8hpp_source}{}\doxysection{utils.\+hpp}
\label{utils_8hpp_source}\index{src/rpp/rpp/schedulers/details/utils.hpp@{src/rpp/rpp/schedulers/details/utils.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//                   ReactivePlusPlus library}}
\DoxyCodeLine{2 \textcolor{comment}{// }}
\DoxyCodeLine{3 \textcolor{comment}{//           Copyright Aleksey Loginov 2022 -\/ present.}}
\DoxyCodeLine{4 \textcolor{comment}{//  Distributed under the Boost Software License, Version 1.0.}}
\DoxyCodeLine{5 \textcolor{comment}{//     (See accompanying file LICENSE\_1\_0.txt or copy at}}
\DoxyCodeLine{6 \textcolor{comment}{//           https://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{7 \textcolor{comment}{// }}
\DoxyCodeLine{8 \textcolor{comment}{//  Project home: https://github.com/victimsnino/ReactivePlusPlus}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <rpp/schedulers/constraints.hpp>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <rpp/subscriptions/subscription\_base.hpp>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }rpp::schedulers::details}
\DoxyCodeLine{18 \{}
\DoxyCodeLine{19 \textcolor{comment}{// keep old\_timepoint to easily understand if we need to sleep (due to sleep is expensive enough even if time in the "{}past"{})}}
\DoxyCodeLine{20 \textcolor{keyword}{inline} \textcolor{keyword}{thread\_local} time\_point s\_last\_sleep\_timepoint\{\};}
\DoxyCodeLine{21 }
\DoxyCodeLine{26 \textcolor{keywordtype}{bool} immediate\_scheduling\_while\_condition(time\_point\&                       time\_point,}
\DoxyCodeLine{27                                           constraint::schedulable\_fn \textcolor{keyword}{auto}\&\& schedulable,}
\DoxyCodeLine{28                                           \textcolor{keyword}{const} subscription\_base\&          sub,}
\DoxyCodeLine{29                                           \textcolor{keyword}{const} std::predicate \textcolor{keyword}{auto}\&        condition)}
\DoxyCodeLine{30 \{}
\DoxyCodeLine{31     \textcolor{keywordflow}{while} (condition())}
\DoxyCodeLine{32     \{}
\DoxyCodeLine{33         \textcolor{keywordflow}{if} (!sub.is\_subscribed())}
\DoxyCodeLine{34             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36         \textcolor{keywordflow}{if} (s\_last\_sleep\_timepoint < time\_point)}
\DoxyCodeLine{37         \{}
\DoxyCodeLine{38             std::this\_thread::sleep\_until(time\_point);}
\DoxyCodeLine{39             s\_last\_sleep\_timepoint = time\_point;}
\DoxyCodeLine{40 }
\DoxyCodeLine{41             \textcolor{keywordflow}{if} (!sub.is\_subscribed())}
\DoxyCodeLine{42                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{43         \}}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 }
\DoxyCodeLine{46         \textcolor{keywordflow}{if} (\textcolor{keyword}{const} \textcolor{keyword}{auto} duration = schedulable())}
\DoxyCodeLine{47             time\_point = time\_point + duration.value();}
\DoxyCodeLine{48         \textcolor{keywordflow}{else}}
\DoxyCodeLine{49             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{50     \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{53 \}}
\DoxyCodeLine{54 \}}

\end{DoxyCode}
